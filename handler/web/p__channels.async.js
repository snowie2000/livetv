"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[482],{2999:function(ve,H,t){t.d(H,{p:function(){return a},v:function(){return b}});var k=t(88767),v=t(85893),a=new k.QueryClient({defaultOptions:{queries:{staleTime:30*1e3,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnWindowFocus:!1}}}),b=function(V){var A=V.children;return(0,v.jsx)(k.QueryClientProvider,{client:a,children:A})}},82250:function(ve,H,t){t.d(H,{h:function(){return A}});var k=t(5574),v=t.n(k),a=t(64599),b=t.n(a),Q=t(30937),V=t(82188),A=new Q.YD({timeout:1e4,baseURL:"/api",withCredentials:!0});A.interceptors.request.use(function(r){if(r.headers["Content-Type"]==="multipart/form-data"){var f=new FormData;for(var Z in r.data)r.data[Z]!==void 0&&r.data[Z]!==null&&f.append(Z,r.data[Z]);r.data=f}if(r.headers["Content-Type"]==="application/x-www-form-urlencoded"){var D=new URLSearchParams;for(var M in r.data)r.data[M]!==void 0&&r.data[M]!==null&&D.set(M,r.data[M]);r.data=D}return r},function(r){console.log(r),Promise.reject(r)}),A.interceptors.response.use(function(r){switch(r.status){case 200:break;case 401:V.m8.replace("/login");default:return Promise.reject(r)}return r},function(r){return r.response?console.error("API Error:",r.response.data):r.request?console.error("Network Error:",r.request):console.error("Error:",r.message),Promise.reject(r)});function J(r){if(!r)return[];var f=r.split(";"),Z=[],D=_createForOfIteratorHelper(f),M;try{for(D.s();!(M=D.n()).done;){var re=M.value,le=re.trim().split("="),q=_slicedToArray(le,2),se=q[0],oe=q[1];Z.push({key:se,value:oe})}}catch(ie){D.e(ie)}finally{D.f()}return Z}},27210:function(ve,H,t){t.r(H),t.d(H,{default:function(){return He}});var k=t(5574),v=t.n(k),a=t(67294),b={container:"container___bXV7B",flex:"flex___Ru_jm",vertical:"vertical___bvCND",center:"center___OWijz",title:"title___TH1Ur",tableWrapper:"tableWrapper___vlH3c",liveUrl:"liveUrl___E7uD9",m3u8:"m3u8____5PD_",playlist:"playlist___S8c1D",toolbar:"toolbar___JnoNk"},Q=t(78957),V=t(68872),A=t(72003),J=t(5529),r=t(66184),f=t(79531),Z=t(14726),D=t(4225),M=t(63606),re=t(2099),le=t(60532),q=t(99611),se=t(86548),oe=t(48689),ie=t(82911),Pe=t(89739),fe=t(10844),be=t(4340),Ze=t(42952),Te=t(57132),Oe=t(93967),we=t.n(Oe),Ee=t(97857),ee=t.n(Ee),T=t(82250),d=t(27494),Ue=t(49288),Ie=t(84567),O=t(88767),me={NewChannelDialog:"NewChannelDialog___A87pQ",TsProxySelector:"TsProxySelector___q636z"},X=t(2999),e=t(85893),Ae=`{"headers": {
    "User-Agent": "Custom User Agent"
    "Referer": "https://example.com/"
}, ...}`;function De(n){var m=d.Z.useForm(),x=v()(m,1),s=x[0],w=(0,a.useState)(!1),S=v()(w,2),W=S[0],E=S[1],U=(0,a.useState)(!1),I=v()(U,2),j=I[0],p=I[1],F=r.default.Option,P=(0,a.useRef)(null),z=(0,a.useState)(""),B=v()(z,2),N=B[0],L=B[1],Y=(0,a.useState)(""),K=v()(Y,2),R=K[0],$=K[1],_=(0,O.useQuery)("parsers",function(){return T.h.get("/plugins").then(function(c){return JSON.parse(c.data).map(function(u){return{label:u,value:u}})})}),i=_.data,G=(0,O.useQuery)("category",function(){return T.h.get("/category").then(function(c){var u;return((u=JSON.parse(c.data))!==null&&u!==void 0?u:[]).map(function(g){return{value:g}})})}),C=G.data,ue=(0,a.useMemo)(function(){var c,u=R.trim();return u?(c=C==null?void 0:C.filter(function(g){return g.value.includes(u)}))!==null&&c!==void 0?c:[]:C},[C,R]),y=(0,a.useMemo)(function(){return n.mode==="view"},[n.mode]);function de(){s==null||s.validateFields().then(function(c){E(!0),n.onAdd(ee()(ee()({},c),{},{Proxy:c.Proxy&&c.Proxy!=="0",TsProxy:c.Proxy==="2"?N:"",ProxyUrl:c.UseProxy?c.ProxyUrl:""})).then(function(){R&&!(C!=null&&C.find(function(u){return u.value===R}))&&X.p.invalidateQueries("category")}).finally(function(){E(!1)})})}(0,a.useEffect)(function(){n.visible&&(p(!1),$(""),s==null||s.resetFields(),s==null||s.setFieldValue("Parser","http"),(n.mode==="edit"||n.mode==="view")&&(s==null||s.setFieldsValue(ee()(ee()({},n.channel),{},{Proxy:n.channel.Proxy?n.channel.TsProxy?"2":"1":"0",UseProxy:!!n.channel.ProxyUrl})),p(!!n.channel.ProxyUrl),L(n.channel.TsProxy)))},[n.visible]);function ne(c,u){var g=u.UseProxy;p(!!g)}return(0,e.jsx)(A.Z,{open:n.visible,onCancel:n.onCancel,onOk:y?n.onCancel:de,cancelButtonProps:{style:{visibility:y?"hidden":"visible"}},destroyOnClose:!0,maskClosable:y,confirmLoading:W,className:me.NewChannelDialog,title:n.mode==="add"?"New Channel":y?"View Channel":"Edit Channel",children:(0,e.jsx)("div",{style:{marginTop:20},children:(0,e.jsx)(d.Z,{labelCol:{span:6},form:s,onValuesChange:ne,initialValues:{Proxy:"0"},children:(0,e.jsxs)("fieldset",{disabled:y,children:[(0,e.jsx)(d.Z.Item,{name:"ID",hidden:!0}),(0,e.jsx)(d.Z.Item,{label:"Channel Name",name:"Name",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"Channel name",allowClear:!0,readOnly:y})}),(0,e.jsx)(d.Z.Item,{label:"Live URL",name:"URL",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"URL",allowClear:!0,readOnly:y})}),(0,e.jsx)(d.Z.Item,{label:"Parser",name:"Parser",rules:[{required:!0}],children:(0,e.jsx)(r.default,{placeholder:"URL",options:i,disabled:y})}),(0,e.jsx)(d.Z.Item,{label:"Category",name:"Category",children:(0,e.jsx)(Ue.Z,{placeholder:"Select or type new category names",options:ue,onSearch:$,disabled:y})}),(0,e.jsx)(d.Z.Item,{label:"Instruction",name:"Extra",rules:[{required:!1}],children:(0,e.jsx)(f.Z.TextArea,{placeholder:Ae,allowClear:!0,rows:4})}),(0,e.jsx)(d.Z.Item,{label:"Proxy stream",name:"Proxy",children:(0,e.jsxs)(r.default,{optionLabelProp:"title",disabled:y,children:[(0,e.jsx)(F,{value:"0",title:"No proxy",children:"No proxy"}),(0,e.jsx)(F,{value:"1",title:"Same as baseurl",children:"Same as baseurl"}),(0,e.jsx)(F,{value:"2",title:"Custom: "+N,children:(0,e.jsxs)("div",{className:me.TsProxySelector,children:[(0,e.jsx)("span",{children:"Custom:"}),(0,e.jsx)(f.Z,{ref:P,onClick:function(u){var g;u.stopPropagation(),(g=P.current)===null||g===void 0||g.focus()},onDoubleClick:function(){var u;(u=P.current)===null||u===void 0||u.select()},placeholder:"https://example.com",value:N,onChange:function(u){return L(u.target.value)}})]})})]})}),(0,e.jsx)(d.Z.Item,{label:"Use Proxy",name:"UseProxy",valuePropName:"checked",children:(0,e.jsx)(Ie.Z,{})}),(0,e.jsx)(d.Z.Item,{label:"Proxy string",name:"ProxyUrl",hidden:!j,children:(0,e.jsx)(f.Z,{placeholder:"socks5://user:password@example.com:443",readOnly:y})})]})})})})}var Me=t(75214),Fe=t(82188),Ne=t(73711),Le=t(64576);function Re(n){var m=d.Z.useForm(),x=v()(m,1),s=x[0],w=d.Z.useForm(),S=v()(w,1),W=S[0],E=(0,a.useState)("config"),U=v()(E,2),I=U[0],j=U[1];function p(){s.setFieldValue("baseurl",window.location.origin)}function F(){var i=Math.random().toString(36).substring(2);s.setFieldValue("secret",i)}var P=function(){return(0,e.jsxs)(d.Z,{labelCol:{span:6},form:s,children:[(0,e.jsx)(d.Z.Item,{name:"cmd",label:"yt-dlp Cmd",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"yt-dlp"})}),(0,e.jsx)(d.Z.Item,{name:"args",label:"yt-dlp Args",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:"--extractor-args youtube:skip=dash -f b -g {url}"})}),(0,e.jsx)(d.Z.Item,{name:"baseurl",label:"BaseUrl",rules:[{required:!0}],children:(0,e.jsx)(f.Z,{placeholder:window.location.origin,suffix:(0,e.jsx)(J.Z,{title:"Autofill with current site",children:(0,e.jsx)(Ne.Z,{onClick:p})})})}),(0,e.jsx)(d.Z.Item,{name:"secret",label:"Server secret",children:(0,e.jsx)(f.Z,{suffix:(0,e.jsx)(J.Z,{title:"Randomize",children:(0,e.jsx)(Le.Z,{onClick:F})})})}),(0,e.jsx)(d.Z.Item,{name:"apikey",label:"Data API",children:(0,e.jsx)(f.Z,{})})]})},z=function(){return(0,e.jsxs)(d.Z,{labelCol:{span:7},form:W,children:[(0,e.jsx)(d.Z.Item,{name:"password",label:"New Password",rules:[{required:!0,message:"Input your password"}],children:(0,e.jsx)(f.Z,{type:"password"})}),(0,e.jsx)(d.Z.Item,{name:"password2",label:"Repeat Password",rules:[{required:!0,message:"Repeat your password"}],children:(0,e.jsx)(f.Z,{type:"password"})})]})},B=function(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["Based on ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994/livetv",children:"LiveTV!"})," by ",(0,e.jsx)("a",{href:"https://github.com/zjyl1994",children:"zjyl1994."})]}),(0,e.jsxs)("div",{children:["Forked by ",(0,e.jsx)("a",{href:"https://github.com/snowie2000",children:"snowie2000"})]}),(0,e.jsxs)("div",{children:["Made with ",(0,e.jsx)("span",{style:{color:"#e25555"},children:"\u2665"})," in Kwangtung."]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{href:"/log",target:"_blank",children:"View log"}),"\xA0\xA0\xA0|\xA0\xA0\xA0",(0,e.jsx)("a",{onClick:function(){return R.mutate()},children:"Log out"})]})]})},N=(0,O.useQuery)("live-config",function(){return T.h.get("/getconfig").then(function(i){return JSON.parse(i.data)})},{enabled:n.visible}),L=N.data;(0,a.useEffect)(function(){n.visible&&L&&s.setFieldsValue(L)},[L,n.visible]),(0,a.useEffect)(function(){n.visible&&j("config")},[n.visible]);var Y=(0,O.useMutation)(function(i){return T.h.post("/updconfig",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("live-config")}}),K=(0,O.useMutation)(function(i){return T.h.post("/changepwd",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}),R=(0,O.useMutation)(function(){return T.h.get("/logout")},{onSuccess:function(){function G(C){document.cookie="".concat(C,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/")}G("mysession"),Fe.m8.replace("/login")}});function $(){switch(I){case"config":{s.validateFields().then(Y.mutateAsync).then(function(){return n.onClose()});break}case"password":{W.validateFields().then(function(i){return i.password!==i.password2?(V.ZP.warning("Passwords do not match"),Promise.reject()):K.mutateAsync(i)}).then(function(){R.mutate(),n.onClose()});break}case"about":{n.onClose();break}}}var _=[{label:"Config",key:"config",children:(0,e.jsx)(P,{})},{label:"Password",key:"password",children:(0,e.jsx)(z,{})},{label:"About",key:"about",children:(0,e.jsx)(B,{})}];return(0,e.jsx)(A.Z,{title:"Options",open:n.visible,onCancel:n.onClose,onOk:$,destroyOnClose:!0,children:(0,e.jsx)(Me.Z,{items:_,defaultActiveKey:"config",activeKey:I,onChange:j})})}var Qe=t(64599),Ve=t.n(Qe);function xe(n){var m,x,s=(0,a.useState)({width:(m=n==null?void 0:n.clientWidth)!==null&&m!==void 0?m:0,height:(x=n==null?void 0:n.clientHeight)!==null&&x!==void 0?x:0}),w=v()(s,2),S=w[0],W=w[1],E=(0,a.useRef)(n);return(0,a.useEffect)(function(){var U=new ResizeObserver(function(I){var j=Ve()(I),p;try{for(j.s();!(p=j.n()).done;){var F=p.value,P=F.contentRect,z=P.width,B=P.height;W({width:z,height:B});return}}catch(N){j.e(N)}finally{j.f()}});return E.current&&U.unobserve(E.current),n&&U.observe(n),function(){U.disconnect()}},[n]),S}var We=t(22850),ze={SmartToolTipContent:"SmartToolTipContent___bmKw0"},Be=function(m){var x=(0,a.useState)(!1),s=v()(x,2),w=s[0],S=s[1];return(0,e.jsx)("span",{style:{display:"inline-block",width:m.width},className:m.className,children:(0,e.jsx)(J.Z,{title:w?m.children:void 0,children:(0,e.jsx)(We.Z.Paragraph,{title:"",ellipsis:{onEllipsis:S},className:ze.SmartToolTipContent,children:(0,e.jsx)(e.Fragment,{children:m.children})})})})},Ke=Be,te=[{title:"#",width:60,dataIndex:"No"},{title:"Name",width:150,dataIndex:"Name"},{title:"Live",dataIndex:"URL",ellipsis:!0},{title:"M3U8",dataIndex:"M3U8",ellipsis:!0},{title:"Proxy",width:80,render:function(m,x){return(0,e.jsxs)(Q.Z,{children:[x.Proxy&&(0,e.jsx)(M.Z,{title:"Stream proxied"}),!!x.ProxyUrl&&(0,e.jsx)(re.Z,{title:"Connect via proxy"})]})}},{title:(0,e.jsx)(le.Z,{}),width:80}],$e=[{label:"M3U",value:"lives.m3u"},{label:"TXT",value:"lives.txt"}];function ye(n){return{id:n.ID,url:n.URL,name:n.Name,proxy:n.Proxy,parser:n.Parser,proxyurl:n.ProxyUrl,tsproxy:n.TsProxy,category:n.Category,extra:n.Extra}}function He(){var n=(0,a.useState)(!1),m=v()(n,2),x=m[0],s=m[1],w=(0,a.useState)(!1),S=v()(w,2),W=S[0],E=S[1],U=(0,a.useState)("add"),I=v()(U,2),j=I[0],p=I[1],F=(0,a.useState)(""),P=v()(F,2),z=P[0],B=P[1],N=(0,a.useState)(!1),L=v()(N,2),Y=L[0],K=L[1],R=(0,a.useState)(15e3),$=v()(R,2),_=$[0],i=$[1],G=(0,a.useState)(),C=v()(G,2),ue=C[0],y=C[1],de=(0,a.useState)("lives.m3u"),ne=v()(de,2),c=ne[0],u=ne[1],g=(0,a.useRef)(null);(0,a.useEffect)(function(){document.title="Channel List - LiveTV!"},[]);var ke=(0,O.useMutation)(function(l){return T.h.post("/newchannel",ye(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList"),i(1e3)},onError:function(o){var h;V.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),Je=(0,O.useMutation)(function(l){return T.h.get("/delchannel",{params:{id:l}})},{onSuccess:function(){X.p.invalidateQueries("channelList")},onError:function(o){var h;V.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),Ge=(0,O.useMutation)(function(l){return T.h.post("/updatechannel",ye(l),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},{onSuccess:function(){X.p.invalidateQueries("channelList"),i(1e3)},onError:function(o){var h;V.ZP.error((h=o==null?void 0:o.data)!==null&&h!==void 0?h:"Unknown error")}}),Ce=(0,O.useQuery)("channelList",function(){return T.h.get("/channels",{responseType:"json"}).then(function(l){i(15e3);var o=JSON.parse(l.data);return Array.isArray(o)&&o.length&&(o.forEach(function(h,ce){var he;h.Parser=h.Parser||"http",h.No=ce,h.Status===0&&i(1e3),(he=h.children)!==null&&he!==void 0&&he.length&&h.children.some(function(st){return st.Status===0})&&i(1e3)}),B(o.shift().M3U8)),o!=null?o:[]})},{refetchInterval:_,refetchOnWindowFocus:!1}),ae=Ce.data,Xe=Ce.isLoading,je=(0,a.useMemo)(function(){return z.replace("lives.m3u",c)},[c,z]);function Ye(){p("add"),s(!0)}function _e(l){return s(!1),j==="add"?ke.mutateAsync(l):Ge.mutateAsync(l)}function qe(){navigator.clipboard.writeText(je).then(function(){K(!0),setTimeout(function(){K(!1)},3e3)}).catch(function(l){console.error("Failed to copy text:",l)})}var pe=(0,a.useCallback)(function(l){y(l),p("edit"),s(!0)},[]),et=(0,a.useCallback)(function(l){y(l),p("view"),s(!0)},[]),ge=(0,a.useCallback)(function(l){A.Z.confirm({title:"Delete channel",content:'Do you want to delete the channel "'+l.Name+'" permanently?',okText:"Delete",cancelText:"Cancel",okType:"danger",onOk:function(){Je.mutate(l.ID)}})},[]),tt=(0,a.useMemo)(function(){return document.querySelector('th[title="M3U8"]')},[ae]),nt=xe(g.current),at=nt.height,rt=xe(tt),Se=rt.width,lt=(0,a.useMemo)(function(){return te[te.length-1].render=function(l,o){return o.Virtual?(0,e.jsx)(q.Z,{onClick:function(){return et(o)}}):(0,e.jsxs)(Q.Z,{children:[(0,e.jsx)(se.Z,{onClick:function(){return pe(o)}}),(0,e.jsx)(oe.Z,{onClick:function(){return ge(o)}})]})},te[3].render=function(l,o,h){var ce=[(0,e.jsx)(ie.Z,{style:{color:"#CCC"}}),(0,e.jsx)(Pe.Z,{style:{color:"#52c41a"}}),(0,e.jsx)(fe.Z,{style:{color:"#faad14"}}),(0,e.jsx)(be.Z,{style:{color:"#ff4d4f"}}),(0,e.jsx)(fe.Z,{style:{color:"#faad14"}})];return(0,e.jsxs)(Q.Z,{children:[(0,e.jsx)(J.Z,{title:(0,e.jsxs)(e.Fragment,{children:[o.Message,(0,e.jsx)("br",{}),o.LastUpdate]}),children:ce[o.Status]}),(0,e.jsx)(Ke,{width:Se-25,children:l})]})},te},[pe,ge,Se]);return(0,e.jsxs)("div",{className:"".concat(b.container," ").concat(b.flex," ").concat(b.vertical," fullpage"),children:[(0,e.jsx)("h1",{className:b.title,children:(0,e.jsxs)(Q.Z,{children:["LiveTV! ",(0,e.jsx)("small",{children:"IPTV feeds on your hand"}),(0,e.jsx)(Ze.Z,{style:{fontSize:"16px"},onClick:function(){return E(!0)}})]})}),(0,e.jsxs)("div",{className:b.toolbar,children:[(0,e.jsxs)("div",{className:we()([b.playlist,"flex"]),children:[(0,e.jsx)("span",{children:"Playlist:\xA0\xA0"}),(0,e.jsxs)(Q.Z.Compact,{style:{flex:"1 1 99%"},children:[(0,e.jsx)(r.default,{defaultValue:"lives.m3u",value:c,onChange:u,options:$e}),(0,e.jsx)(f.Z,{value:je,readOnly:!0}),(0,e.jsx)(J.Z,{title:Y?"Copied":"Click to copy",children:(0,e.jsx)(Z.ZP,{icon:(0,e.jsx)(Te.Z,{}),onClick:qe})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(Z.ZP,{type:"primary",onClick:Ye,style:{marginLeft:"5px"},children:"New channel"})})]}),(0,e.jsx)("div",{className:b.tableWrapper,ref:g,children:(0,e.jsx)(D.Z,{size:"middle",locale:{emptyText:(0,e.jsx)("div",{style:{textAlign:"center"},children:"No channels yet"})},scroll:{x:800,y:at-120},rowKey:"ID",dataSource:ae!=null?ae:[],loading:Xe,columns:lt,virtual:!0,pagination:{defaultPageSize:20,pageSizeOptions:[10,20,50,100],showSizeChanger:!0}})}),(0,e.jsx)(De,{mode:j,visible:x,channel:ue,onAdd:_e,onCancel:function(){return s(!1)}}),(0,e.jsx)(Re,{visible:W,onClose:function(){return E(!1)}})]})}}}]);
